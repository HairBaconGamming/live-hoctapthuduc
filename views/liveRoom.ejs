<!-- app/views/liveRoom.ejs -->
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title><%= room.title %> - Ph√≤ng live</title>
  <link rel="stylesheet" href="/css/liveRoom.css">
  <link rel="icon" type="image/png" href="https://cdn.glitch.global/71030012-56ea-4d26-a426-e0099201df1c/823029_library_512x512.png?v=1741523759119">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
  <script src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"></script>
</head>
<body>
  <input type="hidden" id="username" value="<%= user.username %>">
  <header>
    <h1 class="live-title">
      <i class="fas fa-video"></i>
      Live: <span class="stream-title"><%= room.title %></span>
    </h1>
    <p class="viewer-info">
      <i class="fas fa-users viewer-icon"></i> Ng∆∞·ªùi xem: <span id="viewerCount">0</span>
    </p>
    <!-- N√∫t tho√°t ph√≤ng v·ªõi icon -->
    <button id="exitRoomBtn" class="exit-room-btn">
      <i class="fas fa-right-from-bracket"></i>
      <span>Tho√°t</span>
    </button>
  </header>
  <div class="main-content" id="mainContent">
    <!-- Video Area -->
    <div class="video-area">
      <div class="video-wrapper">
        <video id="liveVideo" class="video-element" autoplay playsinline controls></video>
        <div id="placeholder" class="video-placeholder">
          Ch·ªß ph√≤ng hi·ªán ch∆∞a chia s·∫ª m√†n h√¨nh
        </div>
      </div>
    </div>
    <!-- Ph·∫ßn Chat Area -->
    <div class="chat-area" id="chatArea">
      <div class="chat-header">
        <span>Ph√≤ng Chat</span>
      </div>
      <div id="pinnedComment" class="pinned-comment"></div>
      <div id="chatContent">
        <ul class="chat-messages" id="chatMessages"></ul>
        <!-- Enhanced Chat Input -->
        <div class="chat-input-container">
          <textarea id="chatInputArea" placeholder="Nh·∫≠p tin nh·∫Øn... (H·ªó tr·ª£ Markdown v√† KaTeX)"></textarea>
          <button id="sendChatBtn">G·ª≠i</button>
        </div>
        <!-- V√πng preview hi·ªÉn th·ªã n·ªôi dung Markdown/KaTeX -->
        <div id="chatPreview" class="chat-preview"></div>
      </div>
    </div>
  </div>
  <div id="waitingOverlay" class="waiting-overlay">
    <h2>Ch·ªù ch·ªß ph√≤ng v√†o live...</h2>
  </div>
  <div id="roomEndedOverlay">
    <h2>üî¥ Bu·ªïi ph√°t tr·ª±c ti·∫øp ƒë√£ k·∫øt th√∫c</h2>
    <button onclick="window.location.href='https://hoctap-9a3.glitch.me/live'">
      Quay l·∫°i danh s√°ch Live
    </button>
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
  <!-- C√°c bi·∫øn t·ª´ EJS -->
  <script>
    const roomOwner = "<%= room.owner %>";
    const roomId = "<%= room.id %>";
    const username = "<%= user.username %>";
    const user = {
      username: "<%= user.username %>",
      isPro: <%= user.isPro ? "true" : "false" %>
    };
  </script>
  <script src="/js/liveRoom.js"></script>
</body>
</html>
